<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>CaseA üéÅ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script type="module">
    // ‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    const firebaseConfig = {
  apiKey: "AIzaSyC9dXMaV_L0lFddoL_Ksz0ZtD6c-sVHWDg",
  authDomain: "case-b2d98.firebaseapp.com",
  databaseURL: "https://case-b2d98-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "case-b2d98",
  storageBucket: "case-b2d98.firebasestorage.app",
  messagingSenderId: "402247491014",
  appId: "1:402247491014:web:a5015a1e75c177d15326c7",
  measurementId: "G-6T04XJWNN7"
  };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user;

    document.addEventListener("DOMContentLoaded", async () => {
      // –ü–æ–∫–∞–∂–µ–º –∏–º—è –∏ —Ñ–æ—Ç–æ
      document.getElementById("userName").innerText =
        user.first_name + (user.last_name ? " " + user.last_name : "");

      if (user.photo_url) {
        document.getElementById("userPhoto").src = user.photo_url;
      }

      // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ
      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, `users/${user.id}`));
      if (snapshot.exists()) {
        document.getElementById("reward").innerText =
          "–¢–≤–æ—è –Ω–∞–≥—Ä–∞–¥–∞: " + snapshot.val().reward;
      } else {
        // –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å
        await set(ref(db, `users/${user.id}`), {
          name: user.first_name,
          reward: "–ù–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã"
        });
        document.getElementById("reward").innerText = "–ù–∞–≥—Ä–∞–¥—ã –ø–æ–∫–∞ –Ω–µ—Ç";
      }
    });

    // ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É"
    async function getReward() {
      const reward = "üéÅ –°—É–ø–µ—Ä-–ø—Ä–∏–∑";
      await set(ref(db, `users/${user.id}`), {
        name: user.first_name,
        reward: reward
      });
      document.getElementById("reward").innerText = "–¢–≤–æ—è –Ω–∞–≥—Ä–∞–¥–∞: " + reward;
    }

    window.getReward = getReward;
  </script>
</head>
<body style="font-family:sans-serif; text-align:center; padding:20px;">
  <h2 id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
  <img id="userPhoto" width="100" height="100" style="border-radius:50%; margin:10px;">
  <h3 id="reward">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã...</h3>
  <button onclick="getReward()" style="padding:10px 20px; font-size:16px; background:#3390ec; color:white; border:none; border-radius:10px;">
    –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
  </button>
</body>
</html>
